<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Generic.Semantics.Elaboration.State</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Keyword">module</a> <a id="8" href="Generic.Semantics.Elaboration.State.html" class="Module">Generic.Semantics.Elaboration.State</a> <a id="44" class="Keyword">where</a>

<a id="51" class="Keyword">open</a> <a id="56" class="Keyword">import</a> <a id="63" href="Data.Product.html" class="Module">Data.Product</a>
<a id="76" class="Keyword">open</a> <a id="81" class="Keyword">import</a> <a id="88" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="103" class="Symbol">as</a> <a id="106" class="Module">L</a> <a id="108" class="Keyword">hiding</a> <a id="115" class="Symbol">(</a><a id="116" href="Data.List.Base.html#5513" class="Function">lookup</a><a id="122" class="Symbol">)</a>
<a id="124" class="Keyword">open</a> <a id="129" class="Keyword">import</a> <a id="136" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
<a id="174" class="Keyword">open</a> <a id="179" class="Keyword">import</a> <a id="186" href="Function.html" class="Module">Function</a>

<a id="196" class="Keyword">open</a> <a id="201" class="Keyword">import</a> <a id="208" href="var.html" class="Module">var</a> <a id="212" class="Symbol">as</a> <a id="215" class="Module">V</a>
<a id="217" class="Keyword">open</a> <a id="222" class="Keyword">import</a> <a id="229" href="varlike.html" class="Module">varlike</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="environment.html" class="Module">environment</a> <a id="261" class="Symbol">as</a> <a id="264" class="Module">E</a>
<a id="266" class="Keyword">open</a> <a id="271" class="Keyword">import</a> <a id="278" href="Generic.Syntax.html" class="Module">Generic.Syntax</a>
<a id="293" class="Keyword">open</a> <a id="298" class="Keyword">import</a> <a id="305" href="Generic.Syntax.STLC%252BState.html" class="Module">Generic.Syntax.STLC+State</a>
<a id="331" class="Keyword">open</a> <a id="336" class="Keyword">import</a> <a id="343" href="Generic.Syntax.STLC%252BProduct.html" class="Module">Generic.Syntax.STLC+Product</a>
<a id="371" class="Keyword">open</a> <a id="376" class="Keyword">import</a> <a id="383" href="Generic.Semantics.html" class="Module">Generic.Semantics</a>
<a id="401" class="Keyword">open</a> <a id="406" class="Keyword">import</a> <a id="413" href="Generic.Semantics.Syntactic.html" class="Module">Generic.Semantics.Syntactic</a>

<a id="442" class="Comment">-- Importing the proven-injective type translation</a>
<a id="493" class="Keyword">open</a> <a id="498" class="Keyword">import</a> <a id="505" href="Generic.Semantics.Elaboration.State.Type.html" class="Module">Generic.Semantics.Elaboration.State.Type</a>

<a id="547" class="Comment">-- Environment of the elaboration semantics:</a>
<a id="592" class="Comment">-- Variables of the translated type</a>
<a id="MVAR"></a><a id="628" href="Generic.Semantics.Elaboration.State.html#628" class="Function">MVAR</a> <a id="633" class="Symbol">:</a> <a id="635" href="Generic.Syntax.STLC%252BState.html#214" class="Datatype">MType</a> <a id="641" href="var.html#469" class="Function Operator">─Scoped</a>
<a id="649" href="Generic.Semantics.Elaboration.State.html#628" class="Function">MVAR</a> <a id="654" href="Generic.Semantics.Elaboration.State.html#654" class="Bound">σ</a> <a id="656" href="Generic.Semantics.Elaboration.State.html#656" class="Bound">Γ</a> <a id="658" class="Symbol">=</a> <a id="660" href="var.html#553" class="Datatype">Var</a> <a id="664" href="Generic.Semantics.Elaboration.State.Type.html#297" class="Function Operator">M⟦</a> <a id="667" href="Generic.Semantics.Elaboration.State.html#654" class="Bound">σ</a> <a id="669" href="Generic.Semantics.Elaboration.State.Type.html#297" class="Function Operator">⟧</a> <a id="671" class="Symbol">(</a><a id="672" href="Data.List.Base.html#1120" class="Function">L.map</a> <a id="678" href="Generic.Semantics.Elaboration.State.Type.html#297" class="Function Operator">M⟦_⟧</a> <a id="683" href="Generic.Semantics.Elaboration.State.html#656" class="Bound">Γ</a><a id="684" class="Symbol">)</a>

<a id="687" class="Comment">-- Because M⟦_⟧ is injective, MVAR is VarLike</a>
<a id="vl^MVAR"></a><a id="733" href="Generic.Semantics.Elaboration.State.html#733" class="Function">vl^MVAR</a> <a id="741" class="Symbol">:</a> <a id="743" href="varlike.html#326" class="Record">VarLike</a> <a id="751" href="Generic.Semantics.Elaboration.State.html#628" class="Function">MVAR</a>
<a id="756" href="varlike.html#372" class="Field">new</a>   <a id="762" href="Generic.Semantics.Elaboration.State.html#733" class="Function">vl^MVAR</a>         <a id="778" class="Symbol">=</a> <a id="780" href="var.html#578" class="InductiveConstructor">z</a>
<a id="782" href="varlike.html#417" class="Field">th^𝓥</a> <a id="787" href="Generic.Semantics.Elaboration.State.html#733" class="Function">vl^MVAR</a> <a id="795" class="Symbol">{</a><a id="796" href="Generic.Semantics.Elaboration.State.html#796" class="Bound">σ</a><a id="797" class="Symbol">}</a> <a id="799" href="Generic.Semantics.Elaboration.State.html#799" class="Bound">v</a> <a id="801" href="Generic.Semantics.Elaboration.State.html#801" class="Bound">ρ</a> <a id="803" class="Symbol">=</a> <a id="805" href="Generic.Semantics.Elaboration.State.Type.html#297" class="Function Operator">M⟦_⟧</a> <a id="810" href="var.html#789" class="Function Operator">V.&lt;$&gt;</a> <a id="816" class="Symbol">(</a><a id="817" href="environment.html#396" class="Field">lookup</a> <a id="824" href="Generic.Semantics.Elaboration.State.html#801" class="Bound">ρ</a> <a id="826" class="Symbol">{</a><a id="827" href="Generic.Semantics.Elaboration.State.html#796" class="Bound">σ</a><a id="828" class="Symbol">}</a> <a id="830" class="Symbol">(</a><a id="831" href="Generic.Semantics.Elaboration.State.Type.html#640" class="Function">M⟦⟧-inj</a> <a id="839" href="var.html#1244" class="Function Operator">&lt;$&gt;⁻¹</a> <a id="845" href="Generic.Semantics.Elaboration.State.html#799" class="Bound">v</a><a id="846" class="Symbol">))</a>

<a id="850" class="Comment">-- Target of the Elaboration process</a>
<a id="MTM"></a><a id="887" href="Generic.Semantics.Elaboration.State.html#887" class="Function">MTM</a> <a id="891" class="Symbol">:</a> <a id="893" href="Generic.Syntax.STLC%252BState.html#214" class="Datatype">MType</a> <a id="899" href="var.html#469" class="Function Operator">─Scoped</a>
<a id="907" href="Generic.Semantics.Elaboration.State.html#887" class="Function">MTM</a> <a id="911" href="Generic.Semantics.Elaboration.State.html#911" class="Bound">σ</a> <a id="913" href="Generic.Semantics.Elaboration.State.html#913" class="Bound">Γ</a> <a id="915" class="Symbol">=</a> <a id="917" href="Generic.Syntax.html#1063" class="Datatype">Tm</a> <a id="920" href="Generic.Syntax.STLC%252BProduct.html#737" class="Function">STLCPr</a> <a id="927" class="Symbol">_</a> <a id="929" href="Generic.Semantics.Elaboration.State.Type.html#297" class="Function Operator">M⟦</a> <a id="932" href="Generic.Semantics.Elaboration.State.html#911" class="Bound">σ</a> <a id="934" href="Generic.Semantics.Elaboration.State.Type.html#297" class="Function Operator">⟧</a> <a id="936" class="Symbol">(</a><a id="937" href="Data.List.Base.html#1120" class="Function">L.map</a> <a id="943" href="Generic.Semantics.Elaboration.State.Type.html#297" class="Function Operator">M⟦_⟧</a> <a id="948" href="Generic.Semantics.Elaboration.State.html#913" class="Bound">Γ</a><a id="949" class="Symbol">)</a>

<a id="952" class="Comment">-- Traditional Elaboration Semantics from State to Product</a>
<a id="UnState"></a><a id="1011" href="Generic.Semantics.Elaboration.State.html#1011" class="Function">UnState</a> <a id="1019" class="Symbol">:</a> <a id="1021" href="Generic.Semantics.html#487" class="Record">Sem</a> <a id="1025" href="Generic.Syntax.STLC%252BState.html#628" class="Function">STLCSt</a> <a id="1032" href="Generic.Semantics.Elaboration.State.html#628" class="Function">MVAR</a> <a id="1037" href="Generic.Semantics.Elaboration.State.html#887" class="Function">MTM</a>
<a id="1041" href="Generic.Semantics.html#552" class="Field">Sem.th^𝓥</a> <a id="1050" href="Generic.Semantics.Elaboration.State.html#1011" class="Function">UnState</a> <a id="1058" class="Symbol">{</a><a id="1059" href="Generic.Semantics.Elaboration.State.html#1059" class="Bound">σ</a><a id="1060" class="Symbol">}</a> <a id="1062" class="Symbol">=</a> <a id="1064" href="varlike.html#417" class="Field">th^𝓥</a> <a id="1069" href="Generic.Semantics.Elaboration.State.html#733" class="Function">vl^MVAR</a> <a id="1077" class="Symbol">{</a><a id="1078" href="Generic.Semantics.Elaboration.State.html#1059" class="Bound">σ</a><a id="1079" class="Symbol">}</a>
<a id="1081" href="Generic.Semantics.html#595" class="Field">Sem.var</a>   <a id="1091" href="Generic.Semantics.Elaboration.State.html#1011" class="Function">UnState</a> <a id="1099" class="Symbol">=</a> <a id="1101" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a>
<a id="1106" href="Generic.Semantics.html#654" class="Field">Sem.alg</a>   <a id="1116" href="Generic.Semantics.Elaboration.State.html#1011" class="Function">UnState</a> <a id="1124" class="Symbol">=</a> <a id="1126" class="Keyword">let</a> <a id="1130" class="Keyword">open</a> <a id="1135" href="Generic.Syntax.STLC%252BProduct.html#1015" class="Module">Generic.Syntax.STLC+Product.PATTERNS</a> <a id="1172" class="Keyword">in</a> <a id="1175" class="Symbol">λ</a> <a id="1177" class="Keyword">where</a>
  <a id="1185" class="Symbol">(</a><a id="1186" href="Generic.Syntax.STLC%252BState.html#380" class="InductiveConstructor">App</a> <a id="1190" href="Generic.Semantics.Elaboration.State.html#1190" class="Bound">σ</a> <a id="1192" href="Generic.Semantics.Elaboration.State.html#1192" class="Bound">τ</a> <a id="1194" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1196" href="Generic.Semantics.Elaboration.State.html#1196" class="Bound">f</a> <a id="1198" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1200" href="Generic.Semantics.Elaboration.State.html#1200" class="Bound">t</a> <a id="1202" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1204" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1208" class="Symbol">)</a> <a id="1210" class="Symbol">→</a> <a id="1212" href="Generic.Syntax.STLC%252BProduct.html#1041" class="InductiveConstructor">APP</a> <a id="1216" href="Generic.Semantics.Elaboration.State.html#1196" class="Bound">f</a> <a id="1218" href="Generic.Semantics.Elaboration.State.html#1200" class="Bound">t</a>
  <a id="1222" class="Symbol">(</a><a id="1223" href="Generic.Syntax.STLC%252BState.html#412" class="InductiveConstructor">Lam</a> <a id="1227" href="Generic.Semantics.Elaboration.State.html#1227" class="Bound">σ</a> <a id="1229" href="Generic.Semantics.Elaboration.State.html#1229" class="Bound">τ</a> <a id="1231" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1233" href="Generic.Semantics.Elaboration.State.html#1233" class="Bound">b</a> <a id="1235" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1237" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1241" class="Symbol">)</a>     <a id="1247" class="Symbol">→</a> <a id="1249" href="Generic.Syntax.STLC%252BProduct.html#1091" class="InductiveConstructor">LAM</a> <a id="1253" class="Symbol">(</a><a id="1254" href="varlike.html#1137" class="Function">reify</a> <a id="1260" class="Symbol">{</a><a id="1261" class="Argument">𝓒</a> <a id="1263" class="Symbol">=</a> <a id="1265" href="Generic.Semantics.Elaboration.State.html#887" class="Function">MTM</a><a id="1268" class="Symbol">}</a> <a id="1270" href="Generic.Semantics.Elaboration.State.html#733" class="Function">vl^MVAR</a> <a id="1278" class="Symbol">(</a><a id="1279" href="Generic.Semantics.Elaboration.State.html#1227" class="Bound">σ</a> <a id="1281" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="1283" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a><a id="1285" class="Symbol">)</a> <a id="1287" href="Generic.Semantics.Elaboration.State.html#1229" class="Bound">τ</a> <a id="1289" href="Generic.Semantics.Elaboration.State.html#1233" class="Bound">b</a><a id="1290" class="Symbol">)</a>
  <a id="1294" class="Symbol">(</a><a id="1295" href="Generic.Syntax.STLC%252BState.html#454" class="InductiveConstructor">One</a>     <a id="1303" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1305" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1309" class="Symbol">)</a>         <a id="1319" class="Symbol">→</a> <a id="1321" href="Generic.Syntax.STLC%252BProduct.html#1279" class="InductiveConstructor">ONE</a>
  <a id="1327" class="Symbol">(</a><a id="1328" href="Generic.Syntax.STLC%252BState.html#503" class="InductiveConstructor">Get</a>     <a id="1336" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1338" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1342" class="Symbol">)</a>         <a id="1352" class="Symbol">→</a> <a id="1354" href="Generic.Syntax.STLC%252BProduct.html#1091" class="InductiveConstructor">LAM</a> <a id="1358" class="Symbol">(</a><a id="1359" href="Generic.Syntax.STLC%252BProduct.html#1137" class="InductiveConstructor">PRD</a> <a id="1363" class="Symbol">(</a><a id="1364" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1369" href="var.html#578" class="InductiveConstructor">z</a><a id="1370" class="Symbol">)</a> <a id="1372" class="Symbol">(</a><a id="1373" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1378" href="var.html#578" class="InductiveConstructor">z</a><a id="1379" class="Symbol">))</a>
  <a id="1384" class="Symbol">(</a><a id="1385" href="Generic.Syntax.STLC%252BState.html#519" class="InductiveConstructor">Put</a>     <a id="1393" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1395" href="Generic.Semantics.Elaboration.State.html#1395" class="Bound">t</a> <a id="1397" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1399" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1403" class="Symbol">)</a>     <a id="1409" class="Symbol">→</a> <a id="1411" href="Generic.Syntax.STLC%252BProduct.html#1091" class="InductiveConstructor">LAM</a> <a id="1415" class="Symbol">(</a><a id="1416" href="Generic.Syntax.STLC%252BProduct.html#1137" class="InductiveConstructor">PRD</a> <a id="1420" class="Symbol">(</a><a id="1421" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1426" href="var.html#578" class="InductiveConstructor">z</a><a id="1427" class="Symbol">)</a> <a id="1429" href="Generic.Syntax.STLC%252BProduct.html#1279" class="InductiveConstructor">ONE</a><a id="1432" class="Symbol">)</a>
  <a id="1436" class="Symbol">(</a><a id="1437" href="Generic.Syntax.STLC%252BState.html#573" class="InductiveConstructor">Ret</a> <a id="1441" href="Generic.Semantics.Elaboration.State.html#1441" class="Bound">σ</a>   <a id="1445" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1447" href="Generic.Semantics.Elaboration.State.html#1447" class="Bound">t</a> <a id="1449" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1451" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1455" class="Symbol">)</a>     <a id="1461" class="Symbol">→</a> <a id="1463" href="Generic.Syntax.STLC%252BProduct.html#1091" class="InductiveConstructor">LAM</a> <a id="1467" class="Symbol">(</a><a id="1468" href="Generic.Syntax.STLC%252BProduct.html#1137" class="InductiveConstructor">PRD</a> <a id="1472" class="Symbol">(</a><a id="1473" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1478" href="var.html#578" class="InductiveConstructor">z</a><a id="1479" class="Symbol">)</a> <a id="1481" class="Symbol">(</a><a id="1482" href="Generic.Semantics.Syntactic.html#551" class="Function">ren</a> <a id="1486" href="environment.html#2306" class="Function">extend</a> <a id="1493" href="Generic.Semantics.Elaboration.State.html#1447" class="Bound">t</a><a id="1494" class="Symbol">))</a>
  <a id="1499" class="Symbol">(</a><a id="1500" href="Generic.Syntax.STLC%252BState.html#597" class="InductiveConstructor">Bnd</a> <a id="1504" href="Generic.Semantics.Elaboration.State.html#1504" class="Bound">σ</a> <a id="1506" href="Generic.Semantics.Elaboration.State.html#1506" class="Bound">τ</a> <a id="1508" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1510" href="Generic.Semantics.Elaboration.State.html#1510" class="Bound">m</a> <a id="1512" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1514" href="Generic.Semantics.Elaboration.State.html#1514" class="Bound">f</a> <a id="1516" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1518" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1522" class="Symbol">)</a> <a id="1524" class="Symbol">→</a> <a id="1526" class="Keyword">let</a> <a id="1530" href="Generic.Semantics.Elaboration.State.html#1530" class="Bound">f′</a> <a id="1533" class="Symbol">=</a> <a id="1535" href="Generic.Semantics.Syntactic.html#551" class="Function">ren</a> <a id="1539" href="environment.html#2306" class="Function">extend</a> <a id="1546" href="Generic.Semantics.Elaboration.State.html#1514" class="Bound">f</a> <a id="1548" class="Symbol">;</a> <a id="1550" href="Generic.Semantics.Elaboration.State.html#1550" class="Bound">m′</a> <a id="1553" class="Symbol">=</a> <a id="1555" href="Generic.Semantics.Syntactic.html#551" class="Function">ren</a> <a id="1559" href="environment.html#2306" class="Function">extend</a> <a id="1566" href="Generic.Semantics.Elaboration.State.html#1510" class="Bound">m</a> <a id="1568" class="Keyword">in</a>
                             <a id="1600" href="Generic.Syntax.STLC%252BProduct.html#1091" class="InductiveConstructor">LAM</a> <a id="1604" class="Symbol">(</a><a id="1605" href="Generic.Syntax.STLC%252BProduct.html#1041" class="InductiveConstructor">APP</a> <a id="1609" class="Symbol">(</a><a id="1610" href="Generic.Syntax.STLC%252BProduct.html#1310" class="Function">CUR</a> <a id="1614" href="Generic.Semantics.Elaboration.State.html#1530" class="Bound">f′</a><a id="1616" class="Symbol">)</a> <a id="1618" class="Symbol">(</a><a id="1619" href="Generic.Syntax.STLC%252BProduct.html#1456" class="Function">SWP</a> <a id="1623" class="Symbol">(</a><a id="1624" href="Generic.Syntax.STLC%252BProduct.html#1041" class="InductiveConstructor">APP</a> <a id="1628" href="Generic.Semantics.Elaboration.State.html#1550" class="Bound">m′</a> <a id="1631" class="Symbol">(</a><a id="1632" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1637" href="var.html#578" class="InductiveConstructor">z</a><a id="1638" class="Symbol">))))</a>
</pre></body></html>